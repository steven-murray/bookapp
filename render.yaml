services:
  - type: web
    name: bookapp
    runtime: python
    plan: free
    buildCommand: |
      curl -LsSf https://astral.sh/uv/install.sh | sh
      export PATH="$HOME/.local/bin:$PATH"
      uv sync --no-dev
    startCommand: bash -lc "export PATH=\"$HOME/.local/bin:$PATH\"; uv run flask --app app upgrade-db && uv run gunicorn -w 2 -k gthread -b 0.0.0.0:$PORT app:app"     
    autoDeploy: true
    healthCheckPath: "/"
    envVars:
      - key: SECRET_KEY
        generateValue: true
      # - key: DATABASE_URL
      #   fromDatabase:
      #     name: bookapp-db
      #     property: connectionString

# databases:
#   - name: bookapp-db
#     plan: free
